try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="6e277331-7591-49b0-9f8f-73355478d850",e._sentryDebugIdIdentifier="sentry-dbid-6e277331-7591-49b0-9f8f-73355478d850")}catch(e){}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"9cd379f7d8a2403cc081beb8b3aa2d916ea37864"};(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[5674],{18864:(e,t,o)=>{o.d(t,{Ay:()=>v,rv:()=>g});var a=o(20038),i=o(34524),n=o(5298),s=o(8811),r=o(89625),c=o(16536);const d=["immersiveTakeover","custom","base"],l={immersiveTakeover:null,custom:s.V.default},u=(0,a.Z0)({name:"background",initialState:l,reducers:{unsetBackground:()=>l,setBackground:(e,t)=>{const{layer:o,background:a}=t.payload;e[o]=a}},selectors:{selectBackground:e=>{let t=s.V.default;return Object.values(d).some((o=>!!e[o]&&(t=e[o],!0))),"string"==typeof t?t:{...t}},selectIsImmersiveTakeover:e=>null!==e.immersiveTakeover}}),{unsetBackground:m,setBackground:p}=u.actions,{selectBackground:g,selectIsImmersiveTakeover:f}=u.selectors;(0,c.Zv)({type:n.yc.type,effect:(e,t)=>{const o=t.getState(),a=(0,n.K5)(o),i=g(o);if(!i?.sticky)if("preview"!==a)if("mystery"!==a)if("game"!==a)if("category"!==a)t.dispatch(m());else{const e=(0,n.N2)(o),a=(0,r.r)(e.id);t.dispatch(p({layer:"custom",background:a}))}else{const e=(0,n.Vv)(o),a=(0,r.P)(e);t.dispatch(p({layer:"custom",background:a}))}else{const{mystery:e}=s.V;t.dispatch(p({layer:"custom",background:e}))}else{const{preview:e}=s.V;t.dispatch(p({layer:"custom",background:e}))}}}),(0,c.Zv)({type:i.jO.type,effect:(e,t)=>{const{background:o}=e?.payload?.takeover?.config||{};o&&t.dispatch(p({layer:"immersiveTakeover",background:{...o,style:"dual-cover"}}))}}),(0,c.Zv)({type:i.jp.type,effect:(e,t)=>{t.dispatch(m())}});const v=u.reducer},42891:(e,t,o)=>{o.d(t,{Ay:()=>$,F8:()=>u,Fe:()=>O,H6:()=>P,Jj:()=>x,KM:()=>L,Kk:()=>N,Kn:()=>z,Mh:()=>V,Pl:()=>k,Rd:()=>F,SG:()=>d,W3:()=>B,Wv:()=>U,Xr:()=>R,Xy:()=>l,Y1:()=>m,ac:()=>C,hG:()=>b,nx:()=>h,oJ:()=>T,pX:()=>S,qk:()=>I,rk:()=>D,vR:()=>G,wu:()=>_,xp:()=>E,zO:()=>K,zS:()=>M,zj:()=>A});var a=o(20038),i=o(25508),n=o(36774),s=o(91323);const r={bot:!1,cache:0,device:"desktop",isIpadOS:!1,isIos:!1,isAppleDevice:!1,visibility:!0,history:[],geo:"NL",region:"NH",ccpaApplies:!1,host:"poki.com",viewportOrientation:"portrait",loadingPage:!1,recentGames:[],hydrated:!1,asyncEpicFired:!1,consentStatus:void 0,usPrivacyString:"1---",consistentRandomSeed:Math.random(),externalGames:{},isAdsBlockedVisible:!1,trafficSource:null},c=(0,a.Z0)({name:"client",initialState:r,reducers:{hydrated:e=>{e.hydrated=!0},fireAsyncEpics:e=>{e.asyncEpicFired=!0},setConsentStatus:(e,t)=>{e.consentStatus=t.payload.consentStatus},setUSPrivacyString:(e,t)=>{e.usPrivacyString=t.payload.usPrivacyString},setDevice:(e,t)=>{e.device=t.payload.device},setGeo:(e,t)=>{e.geo=t.payload.geo},setRegion:(e,t)=>{e.region=t.payload.region},setTrafficSource:(e,t)=>{e.trafficSource=t.payload.trafficSource},setHost:(e,t)=>{e.host=t.payload.host},setViewportOrientation:(e,t)=>{e.viewportOrientation=t.payload.orientation},storeRecentGame:(e,t)=>{const{recentGames:o,siteID:a}=t.payload;e.recentGames={...e.recentGames,[a]:o}},setConsistentRandomSeed:(e,t)=>{e.consistentRandomSeed=t.payload.rand},setConsentExternalHostedGame:(e,t)=>{const{gameId:o}=t.payload;e.externalGames={...e.externalGames,[o]:!0}},setAdsBlockedVisible:(e,t)=>{e.isAdsBlockedVisible=t.payload.isVisible}}}),{hydrated:d,fireAsyncEpics:l,setConsentStatus:u,setUSPrivacyString:m,setDevice:p,setGeo:g,setRegion:f,setTrafficSource:v,setHost:y,setViewportOrientation:h,storeRecentGame:S,setConsistentRandomSeed:w,setConsentExternalHostedGame:k,setAdsBlockedVisible:b}=c.actions;function _(e){return e.client.geo}function A(e){return e.client.region}function D(e){return e.client.viewportOrientation}const E=e=>e.client.device;function P(e){const{device:t}=e.client;return"tablet"===t||"mobile"===t}const T=e=>e.client.ccpaApplies,I=(0,i.Mz)((e=>e.client.geo),(e=>n._k.includes(e))),C=e=>e.client.loadingPage&&e.client.hydrated,O=(0,i.Mz)(s.Gd,(e=>e.client.recentGames),((e,t)=>e&&t&&t[e.id]?t[e.id]:[])),G=(0,i.Mz)(O,(e=>e.reduce(((e,t)=>e+t.pt),0))),F=e=>e.client.consistentRandomSeed,M=e=>e.client.isIpadOS,B=e=>e.client.isIos,R=e=>e.client.isAppleDevice,z=e=>e.client.usPrivacyString;function L(e,t){const{externalGames:o}=e.client;return o[t]||!1}const x=e=>e.client.isAdsBlockedVisible,U=(0,i.Mz)((e=>e.client.consentStatus),T,I,((e,t,o)=>t||!o||e===n.T2)),V=e=>e.client.asyncEpicFired,K=e=>e.client.trafficSource,N=()=>{const e="undefined"!=typeof window&&window?.context?.session?.id;if(!e)return 100;let t=0;for(let o=0;o<e.length;o++)t+=e.charCodeAt(o);return t%100},$=c},48554:(e,t,o)=>{o.d(t,{Ay:()=>Ae,Br:()=>G,Co:()=>Z,FK:()=>fe,Kj:()=>ue,QE:()=>se,QX:()=>ce,Rk:()=>q,TQ:()=>L,UO:()=>re,be:()=>ve,cD:()=>ee,gO:()=>X,h8:()=>z,iG:()=>R,iw:()=>J,kK:()=>x,kj:()=>me,lT:()=>le,lh:()=>B,m$:()=>Y,on:()=>N,pT:()=>ge,qA:()=>te,u9:()=>U,vA:()=>Q,wZ:()=>F,wj:()=>pe,yd:()=>ne,yq:()=>M,zM:()=>de});var a=o(20038),i=o(25508),n=o(5298),s=o(79906),r=o(98708),c=o(42891),d=o(89385),l=o(40620),u=o(15203),m=o(25733),p=o(10179),g=o(40890),f=o(13150),v=o(46493),y=o(17782),h=o(16536),S=o(73934),w=o(83228),k=o(46278),b=o(65995),_=o(23038),A=o(61363);const D={isFullscreen:!1,wasFullscreen:!1,showAdStatus:!1,adStatusEvent:"",adDuration:0,adCurrentTime:0,loadingFinished:!1,lastCloudSaveTimestamp:0,mobileNavPosition:void 0},E=(0,k.T5)(),P=`${E}/players/gamesave`,T=`${E}/auth/issue-token`,I=864e5,C=[I,I,6048e5,2592e6],O=(0,a.Z0)({name:"game",initialState:D,reducers:{setFullscreen:(e,t)=>{e.isFullscreen=t.payload.toggle,e.wasFullscreen=e.wasFullscreen||t.payload.toggle},setGameLoadingFinished:(e,t)=>{e.loadingFinished=t.payload},setPubHostData:(e,t)=>{const{gameId:o,data:a}=t.payload;e[o]={...e[o],pubHostData:a}},showAdStatus:e=>{e.showAdStatus=!0},hideAdStatus:e=>{e.showAdStatus=!1},setAdStatusEvent:(e,t)=>{e.adStatusEvent=t.payload.event},setAdDurationAndProgress:(e,t)=>{e.adDuration=t.payload.duration,e.adCurrentTime=t.payload.currentTime},setLastCloudSaveTimestamp:(e,t)=>{e.lastCloudSaveTimestamp=t.payload},setMobileNavPosition:(e,t)=>{const{topPercent:o,topPx:a}=t.payload;e.mobileNavPosition={topPercent:o,topPx:a}}},extraReducers:e=>{e.addCase(n.yc,(e=>{e.mobileNavPosition=void 0}))}}),G=(0,y.A)("game/boot"),F=(0,y.A)("game/receive_game_event"),M=(0,y.A)("game/receive_sdk_details"),B=(0,y.A)("game/request_full_screen"),R=(0,y.A)("game/pub_host_initialized"),z=(0,y.A)("game/set_poki_url_params"),L=(0,y.A)("game/receive_command"),x=(0,y.A)("game/generate_screenshot"),U=(0,y.A)("game/receive_screenshot"),V=(0,y.A)("game/receive_score"),K=(0,y.A)("game/forward_game_event"),N=(0,y.A)("game/fetch_save_game"),$=(0,a.VP)("game/mutate_save_game"),Z=(0,y.A)("game/cloud_save_game_script_error"),H=(0,y.A)("game/poki_accounts_open_auth_panel"),j=(0,y.A)("game/poki_accounts_get_user_token"),W=(0,y.A)("game/open_external_link"),{setFullscreen:X,setGameLoadingFinished:q,setPubHostData:J,showAdStatus:Q,hideAdStatus:Y,setAdStatusEvent:ee,setAdDurationAndProgress:te,setLastCloudSaveTimestamp:oe,setMobileNavPosition:ae}=O.actions,ie=(0,i.Mz)(n.Vv,(e=>e.game),((e,t)=>t[e&&e.id]||{}));function ne(e){const t=ie(e);return t?.pubHostData||null}function se(e){const t=(0,n.Vv)(e);return!!t?.fullscreen}const re=(0,i.Mz)(n.Vv,c.zS,n.K5,u.Bi,((e,t,o,a)=>"game"===o?"flash"===e?.file?.render_type||e?.alternative_game_enabled||t&&!e?.mobile_available:"mystery"===o&&!a)),ce=e=>e.game.isFullscreen,de=e=>e.game.wasFullscreen,le=e=>e.game.showAdStatus,ue=e=>e.game.adStatusEvent,me=e=>e.game.adDuration,pe=e=>e.game.adCurrentTime,ge=e=>e.game.loadingFinished,fe=e=>e.game.lastCloudSaveTimestamp,ve=e=>e.game.mobileNavPosition,ye={pubHostInitialized:R,[f.oQ]:F,[f.Oi]:M,[f.AU]:z,[f.zR]:L,[f.RC]:U,[f.Zf]:V,[f.vO]:K,[f.Kt]:H,[f.Xo]:j,[f.W2]:W,[f.IW]:ae,fetchSaveGame:N,mutateSaveGame:$,SaveGameMigrator:!0},he=["localhost","games.poki.com","game-cdn.poki.com"],Se=["pokiMessageEvent","pokiMessageDebug","SaveGameMigrator"];function we({event:e,dispatch:t}){const o=function({event:e}){const{type:t}=e.data||{};if(!t||!ye[t])return!1;if("function"!=typeof ye[t]&&!Se.includes(t))return!1;const o=(0,g.aX)(e.origin)||"",a=he.includes(o)||o.endsWith(".poki-gdn.com")||o.endsWith(".gdn.poki.com")||window.location.origin===e.origin,i=document.querySelector('iframe[name="gameFrame"]'),n=i&&i.src.startsWith(e.origin);return a||n}({event:e});if(!o)return;const{content:a,type:i}=e.data;if(Se.includes(i)&&(0,v.F)({category:"sdk",action:"message",data:{content:a,type:i}}),"function"==typeof ye[i]){const o=e.source;t(ye[i]({...a,source:o}))}}(0,h.Zv)({type:c.Xy.type,effect:(e,t)=>{const{dispatch:o}=t;void 0!==window.pokiMessageListener&&window.removeEventListener("message",window.pokiMessageListener),window.pokiMessageBuffer&&window.pokiMessageBuffer.forEach((e=>{we({event:e,dispatch:o})})),window.addEventListener("message",(e=>{we({event:e,dispatch:o})}))}});const ke=(0,a.zD)("game/push_save_game_to_cloud",(async({gameID:e,saveGameData:t},o)=>{const a=t.playtime||0;try{const i=JSON.stringify({ls:t.ls,idb:t.idb}),n=new Blob([i]).size;let s=i,r=n,c=1,l=!0;try{s=await(0,S.B)(i),r=s.size,c=r/n}catch(e){l=!1,console.error(e)}if(console.info(`[SaveGame] Compression results - Original: ${n/1024}KB, Compressed: ${r/1024}KB, Compression ratio: ${(100*c).toFixed(2)}% of the original size`),r>w.Im)return console.error(`[SaveGame] Game file is too large after compression ${r/1048576}mb`),(0,v.F)({category:"account",action:"gamesaveSizeTooLarge",data:{gameId:e,size:r,originalSize:n,compressionRatio:c}}),void o.dispatch((0,d.hK)({gameID:e,saveGameSize:r}));const u={"X-Poki-Pt":a.toString(),"X-Poki-Api-Version":"v2"};l&&(u["Content-Encoding"]="gzip"),o.dispatch(oe(Date.now()));const m=await fetch(`${P}/${e}`,{method:"POST",body:s,credentials:"include",headers:u});if(!m.ok)throw new Error(`Failed to save user games: ${m.status}`);const p=m.headers.get("Etag");p&&window.frames?.gameFrame?.postMessage?.({type:"pokiSetEtag",etag:p},"*"),(0,v.F)({category:"account",action:"gamesaveSuccess",data:{gameId:e,size:r,originalSize:n,compressionRatio:c}});const g=new Date;console.info(`[SaveGame] cloud sync - game: ${e}, at: ${g.toLocaleString()}`)}catch(t){console.error("[SaveGame] error pushing to cloud",t),(0,v.F)({category:"account",action:"gamesaveError",data:{gameId:e,method:"pushSaveGameToCloud",context:"sending gamesave to the cloud",error:t instanceof Error?`${t.name}: ${t.message}`:String(t)}})}}));(0,h.Zv)({type:$.type,effect:(e,t)=>{const o=t.getState(),a=(0,n.Vv)(o)?.id,i=(0,d.Ep)(o),s=(0,d.Fh)(o);if(!i||!a||s.includes(a))return;if((0,w.jJ)(e.payload))return;const r={playtime:parseInt(e.payload.metadata?.playtime||"0",10),ls:e.payload.ls||"",idb:e.payload.idb||""};t.dispatch(ke({gameID:a,saveGameData:r}))}});const be=Math.random().toString(36).substring(2);(0,h.Zv)({actionCreator:d.hK,effect:(e,t)=>{const o=ne(t.getState()),{gameID:a,gameVersion:i}=o||{},n="LargeGameSave",s="Savegame is too large to sync to Poki User Account (max 1MB allowed)",r=JSON.stringify({gid:a,vid:i,ve:7,n,m:s,ui:be}),c=`${k.N8}/ge`;fetch(c,{method:"POST",body:r})}}),(0,h.Zv)({type:H.type,effect:(e,t)=>{const o=t.getState(),a=(0,d.ij)(o),i=(0,n.Vv)(o)?.id,s=e.version||0;if(!a){let a="unknown";switch(s){case 0:a=`sdk-${i}`;break;case 1:a=e.trigger}t.dispatch((0,d.qf)({source:a})),(0,v.F)({category:"account",action:"sdkOpenAuthPanel",data:{source:a,gameID:(0,n.Vv)(o)?.id}})}}}),(0,h.Zv)({type:j.type,effect:async(e,t)=>{const o=t.getState(),a=(0,n.Vv)(o)?.pokifordevs_game_id,i=(0,d.Ep)(o),s=e=>{window.frames?.gameFrame?.postMessage?.({type:"pokiAccountsUserToken",token:null,error:e},"*")};if(!a)return void s("No gameID found");if(!i)return void s("User is not logged in");let r,c;try{r=await fetch(`${T}?game_id=${a}`,{method:"GET",credentials:"include"})}catch(e){return console.error(e),void s("Network error while generating token")}if(r.ok){try{c=await r.json()}catch{return void s("Failed to parse user token")}window.frames?.gameFrame?.postMessage?.({type:"pokiAccountsUserToken",token:c.token},"*")}else s("Failed to generate user token")}}),(0,h.Zv)({type:V.type,effect:(e,t)=>{const{leaderboard:o,score:a,timeOnPage:i}=e.data;let{meta:s}=e.data;const r=t.getState(),c=(0,n.Vv)(r);if(!c||!c.pokifordevs_game_id)return;const l=(0,d.IT)(r);s||(s={time_on_page:Math.round(i)}),(0,b.g)(o,a,s,c.pokifordevs_game_id,l?.identity?.id)}}),(0,h.Zv)({type:K.type,effect:e=>{if(window.pokiBotDetected?.length>0)return;const{payload:t}=e,o=(0,m.H)();t.pageview_id=o.page.pageview_id;const a=`${k.N8}/game-event`;fetch(a,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(t),mode:"no-cors",keepalive:!0,credentials:"omit"}).catch((e=>{console.warn("%cPOKI:%c failed to submit game event","font-weight: bold","",e)}))}}),(0,h.Zv)({type:W.type,effect:(e,t)=>{const{params:{url:o}}=e;if(o&&"string"==typeof o)try{const e=new URL(o);t.dispatch((0,s.mi)({modal:{id:A.HEADSUP_MODAL_ID,iconDesktop:"ui-icons-exclamation",iconMobile:"content-icons-warning",childComponent:{name:"modals/HeadsUpModal",props:{externalLinkURL:e.toString()}}}}))}catch{console.error("Invalid external link URL format:",o)}}});let _e=!1;(0,h.Zv)({predicate:e=>(0,a.i0)(p.sx.rejected,n.yc)(e)||e.type===F.type,effect:(e,{getState:t,dispatch:o,unsubscribe:a})=>{if(p.sx.rejected.match(e)&&(_e=!0),!p.sx.rejected.match(e)&&!_e)return;if(e.type===F.type&&e.event!==f.zY)return;const i=t(),u=(0,d.Ep)(i),m=(0,c.Xr)(i),g=(0,r.K)(i);if(u)return void a();const y=(0,n.K5)(i);if((0,c.vR)(i)>=(m?1800:3600)){if("game"!==y){const e=(0,s.PR)(i,A.POWERUSER_MODAL_ID),t=window.innerWidth>1870;if(e)return;return(0,v.F)({category:"account",action:"powerUserMessageShown",label:"tooltip"}),o((0,l.oK)({tooltip:{id:"powerUserTooltip",consumerId:"navButtonProfile",htmlContent:`<strong>${g.playing_time}</strong><p>${g.sign_in_to_save}</p>`,showCloseButton:!0,preventAutoDismiss:!0,position:t?"right":"bottom",muteAfterClose:!1}})),void o((0,s.BE)({id:A.POWERUSER_MODAL_ID,muteExpirationTime:C}))}o((0,s.mi)({modal:{id:A.POWERUSER_MODAL_ID,iconDesktop:m?"ui-icons-floppy-disk":"ui-icons-clock",iconMobile:m?"content-icons-floppy-disk":"content-icons-clock",showCloseButtonInHeader:!0,muteExpirationTime:C,childComponent:{name:"modals/PowerUserModal"}}}))}}}),(0,h.Zv)({predicate:e=>e.type===F.type&&e.event===f.zY,effect:(e,t)=>{const o=t.getState();if(!(0,d.Ep)(o))return void t.unsubscribe();const a=(0,d.C4)(o),i=(0,d.jv)(o);if(a)return t.dispatch((0,d.Bp)({showNotificationBubble:!1})),void t.unsubscribe();t.dispatch(_.lh.endpoints.getProfile.initiate({extraOptions:"/username/status"},{forceRefetch:!0})).then((e=>{const o=e?.data?.can_update_now;if(o&&(t.unsubscribe(),t.dispatch((0,d.Bp)({showNotificationBubble:!0})),t.dispatch((0,l.oK)({tooltip:{id:"usernameUnlocked",consumerId:"userAvatar",htmlContent:"<strong>User name unlocked.</strong><p>Try it out in your account.</p>",muteAfterClose:!0,showCloseButton:!0}})),i)){const e=window.innerWidth<=768;t.dispatch((0,l.oK)({tooltip:{id:"profileOverflow_username",consumerId:"profileOverflow",htmlContent:"User names available",muteAfterClose:!0,icon:"ui-icons-pencil",position:e?"left":"right"}}))}}))}});const Ae=O}}]);
//# sourceMappingURL=client~main-d6657317~c8a9d028b7e1f8fc377d.js.map